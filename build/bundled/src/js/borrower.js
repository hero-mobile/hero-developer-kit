!function(){window.borrower={fmoney:function(a,e){e=e>=0&&e<=20?e:2,a=parseFloat((a+"").replace(/[^\d\.-]/g,"")).toFixed(e)+"";var n=a.split(".")[0].split("").reverse(),o=a.split(".")[1];for(t="",i=0;i<n.length;i++)t+=n[i]+((i+1)%3==0&&i+1!=n.length?",":"");return t.split("").reverse().join("")+(o?"."+o:"")},on:function(json){if("string"==typeof json&&(json=eval("("+json+")")),"get"===json.login){var username=json.usernameStr,password=json.passwordStr;if(""===username||""===password||void 0===username||void 0===password)return void API.out({datas:[{name:"err",hidden:!1,text:"错误消息:请输入用户名和密码"}]});xhr({url:host+"/api/v2/users/login",data:{identity:username,password:password},async:!0,method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result?(localStorage.username=username,API.out({command:"dismiss"})):"error"===data.result&&API.out({datas:[{name:"err",hidden:!1,text:data.errors[0]}]})},error:function(t){API.out({command:"stopLoading"}),API.out({datas:[{name:"err",hidden:!1,text:"错误消息:"+("0"===t?"网络无法接通":t)}]})}})}else if(json.me)xhr({url:host+"/api/v2/borrower/info",async:!0,method:"GET",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API["in"]({userinfo:data})},error:function(t){API["in"]({userinfo:"网络错误"})}});else if(json.acount)xhr({url:host+"/api/v2/borrower/getPaymentSummary",async:!0,method:"GET",success:function(data){if("string"==typeof data&&(data=eval("("+data+")")),"success"===data.result)API.out({datas:[{name:"money",text:borrower.fmoney(data.content.loanAmount,2)},{name:"day",text:"每月"+data.content.paymentDay+"日"},{name:"num",text:"账单(共"+data.content.maturity+"期)"}]}),data.content.currentPayment&&data.content.nextPayment?API.out({datas:[{name:"next_t2",text:borrower.fmoney(data.content.nextPayment.totalAmount,2)+""},{name:"cur_t1",text:data.content.currentPayment.unpaidAmount>0?borrower.fmoney(data.content.currentPayment.unpaidAmount,2):"已结清"},{name:"cur_t1",textColor:"overdue"===data.content.currentPayment.paymentStatus?"db3e3e":"838592"},{name:"cur_t2",hidden:!1,text:"第"+data.content.currentPayment.number+"期"},{name:"cur_t3",hidden:"overdue"!==data.content.currentPayment.paymentStatus},{name:"cur_b",click:{command:"goto:"+path+"/payment_current.html?totalAmount="+data.content.currentPayment.totalAmount+"&paidAmount="+data.content.currentPayment.paidAmount+"&paymentStatus="+data.content.currentPayment.paymentStatus+"&number="+data.content.currentPayment.number+"&dueDate="+data.content.currentPayment.dueDate+"&unpaidAmount="+data.content.currentPayment.unpaidAmount}},{name:"speed_b",enable:data.content.currentPayment.unpaidAmount>0,title:data.content.currentPayment.unpaidAmount>0?"快速还款":"本期已结清"}]}):data.content.currentPayment?API.out({datas:[{name:"next_t2",text:borrower.fmoney(data.content.currentPayment.totalAmount,2)+""},{name:"cur_t1",text:data.content.currentPayment.unpaidAmount>0?borrower.fmoney(data.content.currentPayment.unpaidAmount,2):"已结清"},{name:"cur_t1",textColor:"overdue"===data.content.currentPayment.paymentStatus?"db3e3e":"838592"},{name:"cur_t2",hidden:!1,text:"第"+data.content.currentPayment.number+"期"},{name:"cur_t3",hidden:"overdue"!==data.content.currentPayment.paymentStatus},{name:"cur_b",click:{command:"goto:"+path+"/payment_current.html?totalAmount="+data.content.currentPayment.totalAmount+"&paidAmount="+data.content.currentPayment.paidAmount+"&paymentStatus="+data.content.currentPayment.paymentStatus+"&number="+data.content.currentPayment.number+"&dueDate="+data.content.currentPayment.dueDate+"&unpaidAmount="+data.content.currentPayment.unpaidAmount}},{name:"speed_b",enable:data.content.currentPayment.unpaidAmount>0,title:data.content.currentPayment.unpaidAmount>0?"快速还款":"本期已结清"},{name:"next_t2",hidden:!0},{name:"next_t1",hidden:!0},{name:"next_b",hidden:!0}]}):data.content.nextPayment&&API.out({datas:[{name:"next_t2",text:borrower.fmoney(data.content.nextPayment.totalAmount,2)+""},{name:"cur_t1",hidden:!0},{name:"cur_t1",hidden:!0},{name:"cur_t0",hidden:!0},{name:"cur_t2",hidden:!0},{name:"cur_t3",hidden:!0},{name:"cur_b",hidden:!0},{name:"next_t2",hidden:!1,frame:{r:"25",w:"120",h:"0.1x",t:"0.45x"}},{name:"next_t1",hidden:!1,frame:{x:"15",w:"140",h:"0.1x",t:"0.45x"}},{name:"next_b",hidden:!1,frame:{x:"-1",w:"1.005x",h:"0.1x",t:"0.4501x"}},{name:"speed_b",enable:!1,title:"本期无账单"}]});else if("login"===data.result){var authServer="https://auth.dianrong.com";host.search(/localhost|10/)>0&&(authServer=host),host.search(/dev/)>0?authServer="https://auth-dev.dianrong.com":host.search(/demo/)>0&&(authServer="https://auth-demo.dianrong.com"),API.out({command:"present:"+authServer+"/auth-server/borrower-static/wallet/v3/login.html"})}},error:function(t){}});else if(json.repayment)xhr({url:host+"/api/v2/borrower/getBorrowerDeductionInfo",async:!0,method:"GET",success:function(data){if("string"==typeof data&&(data=eval("("+data+")")),"success"===data.result)API.out({datas:[{name:"table",data:[{rows:[{title:"本期剩余金额",textValue:data.content.unpaidAmount+""},{title:"代扣银行卡",textValue:data.content.financialInstitution+" 尾号 "+data.content.accountNumber.substr(data.content.accountNumber.length-4,4)}]}]},{name:"money",text:data.content.unpaidAmount+""},{name:"button",enable:data.content.unpaidAmount>0}]}),window.currentPayMoney=data.content.unpaidAmount,void 0!==data.content.accountNumber&&""!==data.content.accountNumber||API.out({command:{show:{title:"",content:"尚未绑定代扣银行卡",cancel:"返回",cancelAction:{command:"dismiss"}}}});else if("login"===data.result){var authServer="https://auth.dianrong.com";host.search(/localhost|10/)>0&&(authServer=host),host.search(/dev/)>0?authServer="https://auth-dev.dianrong.com":host.search(/demo/)>0&&(authServer="https://auth-demo.dianrong.com"),API.out({command:"present:"+authServer+"/auth-server/borrower-static/wallet/v3/login.html"})}},error:function(t){API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}});else if(json.pay){var amount=json.pay.money;xhr({url:host+"/api/v2/borrower/deductBorrowerAccount",async:!0,data:{amount:amount},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),"success"===data.result?API.out({datas:[{name:"result",text:"还款申请已经提交"},{name:"button",enable:!0,title:"完成",backgroundColor:"37B98f",tinyColor:"ffffff",click:{command:"dismiss"}}]}):"input"===data.result?API.out({datas:[{name:"result",text:"还款申请提交失败，缺少必要参数",size:14},{name:"button",enable:!0,title:"重试",backgroundColor:"37B98f",tinyColor:"ffffff",click:{command:"back"}}]}):"error"===data.result?API.out({datas:[{name:"result",text:data.errors[0]+"",size:14},{name:"button",enable:!0,title:"重试",backgroundColor:"37B98f",tinyColor:"ffffff",click:{command:"back"}}]}):API.out({datas:[{name:"result",text:"还款申请提交失败，请稍候再试...",size:14},{name:"button",enable:!0,title:"重试",backgroundColor:"37B98f",tinyColor:"ffffff",click:{command:"back"}}]})},error:function(t){API.out({datas:[{name:"result",text:"还款申请提交失败，请稍候再试...",size:14},{name:"button",enable:!0,title:"重试",backgroundColor:"37B98f",tinyColor:"ffffff",click:{command:"back"}}]})}})}else if(json.history)xhr({url:host+"/api/v2/borrower/borrowerpaymenthistory",async:!0,method:"GET",success:function(data){if("string"==typeof data&&(data=eval("("+data+")")),"success"===data.result){var result={name:"table",data:[{rows:[]}]};for(var num in data.content.paymentList){var item=data.content.paymentList[num],d=new Date;d.setTime(item.transDate);var dStr=d.toLocaleString();dStr=dStr.replace(/GMT\+8/,""),result.data[0].rows.push({res:"MafiaThreeValueCell",one:dStr,two:item.amount,three:item.status})}API.out({datas:[result]}),result.data[0].rows.length<1&&API.out({datas:[{name:"nodata",hidden:!1}]})}else"error"===data.result},error:function(t){API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}});else if(json.la&&json.lo){var lat=json.la,lng=json.lo;xhr({url:host+"/api/v2/borrower/submitBorrowerGpsInfo",async:!0,data:{lat:lat,lng:lng,status:lat>0?1:0},method:"POST",success:function(t){},error:function(t){}})}else if(json.fetchverifycode4register){var userType="BORROWER",cellphone=json.regPhone,capture=json.capture,param={};param=capture&&capture.length>0?{userType:userType,cellphone:cellphone,capture:capture}:{userType:userType,cellphone:cellphone},xhr({url:host+"/api/v2/users/fetchverifycode4register",async:!0,data:param,method:"POST",success:function(data){if("string"==typeof data&&(data=eval("("+data+")")),console.log(JSON.stringify(data)),API.out({command:"stopLoading"}),"success"===data.result)if(capture&&capture.length>0||(clearInterval(counddowninterval),countdown=countdownsecond),capture&&capture.length>0){var boot={code:data.content.response,regPhone:cellphone};localStorage.boot=JSON.stringify(boot),API.out({command:"load:"+path+"/register2.html"})}else API.out({datas:{name:"countdown",title:countdown+"s后重新发送",enable:!1}}),counddowninterval=setInterval(countDown,1e3),API.out({datas:{name:"msgCode",text:data.content.response}});else if("login"===data.result){var authServer="https://auth.dianrong.com";host.search(/localhost|10/)>0&&(authServer=host),host.search(/dev/)>0?authServer="https://auth-dev.dianrong.com":host.search(/demo/)>0&&(authServer="https://auth-demo.dianrong.com"),API.out({command:"present:"+authServer+"/auth-server/borrower-static/wallet/v3/login.html"})}else if(data.errors){if(captcha){var url=host+"/images/captcha.jpg?t="+(new Date).getTime();API.out({datas:{name:"captchaImg",image:url}})}else API.out({datas:{name:"countdown",enable:!0}});API.out({datas:{name:"toast",text:data.errors[0]}})}},error:function(t){API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else if(json.register){var regPhone=json.regPhone,regPhoneResponseCode=json.regPhoneResponseCode,password=json.password,inviteCode=json.inviteCode,umengChannel=json.channel;xhr({url:host+"/api/v2/borrower/create",async:!0,data:{clientSource:umengChannel,clientSourceType:"BORROW_APP_MARKET",regPhone:regPhone,regPhoneResponseCode:regPhoneResponseCode,password:password,inviteCode:inviteCode},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),"success"===data.result?(API.out({datas:{name:"toast",text:"注册成功",icon:"ok"}}),setTimeout(function(){API["in"]({login:"get",usernameStr:regPhone,passwordStr:password})},1e3)):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else if(json.updateSSN){var loanId=json.loanId,name=json.name,address=json.address,ssn=json.ssn,signPlace=json.signPlace,deadline=json.deadline;xhr({url:host+"/api/v2/borrower/upload/ssn",async:!0,data:{loanId:loanId,name:name,ssn:ssn,signPlace:signPlace,deadline:deadline,address:address},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result?API.out({datas:[{name:"area1",frame:{y:"150",h:"54",w:"1x"},animation:.2},{name:"area2",frame:{y:"214",h:"54",w:"1x"},click:{datas:{name:"ocr",type:"银行卡"}},animation:.2},{name:"title2",frame:{x:"20",y:"214",h:"54",w:"1x"},animation:.2},{name:"next",frame:{x:"20",r:"20",h:"54",t:"300"},title:"提交",animation:.2},{name:"sucess2",hidden:!0},{name:"arrow2",frame:{r:"0",w:"27",h:"13",t:"234"},image:"account_arrow",animation:.2},{name:"realName",hidden:!0},{name:"idNumber",hidden:!0},{name:"address",hidden:!0},{name:"auth",hidden:!0},{name:"line1",hidden:!0},{name:"line2",hidden:!0},{name:"authDate",hidden:!0},{name:"step",image:"step2",animation:.2},{name:"stepTitle",text:"请务必扫描本人借记卡以保证正确放款"},{name:"title1",text:"持卡人"},{name:"sucess1",text:name},{name:"title2",text:"扫描银行借记卡"},{name:"next",enable:!1}]}):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({command:"stopLoading"}),API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else if(json.updateBankCard){var loanId=json.loanId,name=json.name,bankCard=json.bankCard.replace(/ /g,"");xhr({url:host+"/api/v2/borrower/upload/bankcard",async:!0,data:{loanId:loanId,name:name,bankCard:bankCard},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result?API.out({command:"dismiss"}):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({command:"stopLoading"}),API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else if(json.updateBorrowerLoanApp){var loanName=json.loanName,la=json.lat,lo=json.lng,money=json.money,date=json.date,city=json.city,usage=json.usage;xhr({url:host+"/api/v2/borrower/updateBorrowerLoanApp",async:!0,data:{loanAmount:money,lat:la,lng:lo,loanMaturity:date,configName:loanName,city:city,loanPurpose:usage},method:"POST",success:function(data){if("string"==typeof data&&(data=eval("("+data+")")),"success"===data.result)if("NONE"===data.content.status){var boot={loanId:data.content.loanId};localStorage.boot=JSON.stringify(boot),API.out({command:{show:{title:"申请提交成功",content:"您的申请已提交成功，请继续完善资料",cancel:"完善申请资料",cancelAction:{globle:{key:"tabSelect",value:1}}}}})}else API.out({command:{show:{title:"申请已提交",content:"我们的工作人员会尽快和您联系，请保持手机畅通",cancel:"继续",cancelAction:{command:"rootBack"}}}});else"error"===data.result&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else if(json.gps2city){var la=json.lat,lo=json.lng;xhr({url:host+"/api/v2/borrower/geography/geocodercity",async:!0,data:{lat:la,lng:lo},method:"GET",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),"success"===data.result?API.out({city:data.content.result}):API.out({city:" "})},error:function(t){API.out({city:" "})}})}else if(json.resetpwdverifycode){var emailOrPhone=json.phone,type="resetpwd",attempt=json.attempt,captcha=json.captcha;xhr({url:host+"/api/v2/users/fetchverifycode",async:!0,data:{emailOrPhone:emailOrPhone,captcha:captcha,type:type,attempt:attempt},method:"POST",success:function(data){if("string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result){var boot={phoneNumber:json.phone,code:data.content.response};localStorage.boot=JSON.stringify(boot),API.out({command:"goto:"+path+"/forget1.html"})}else if(data.errors){var url=host+"/images/captcha.jpg?t="+(new Date).getTime();API.out({datas:{name:"captchaImg",image:url}}),API.out({datas:{name:"toast",text:data.errors[0]}})}},error:function(t){var a=host+"/images/captcha.jpg?t="+(new Date).getTime();API.out({datas:{name:"captchaImg",image:a}}),API.out({command:"stopLoading"})}})}else if(json.resetpassword){var emailOrPhone=json.phone,confCode=json.code,password=json.password;xhr({url:host+"/api/v2/users/password/reset/submit",async:!0,data:{emailOrPhone:emailOrPhone,confCode:confCode,password:password,passwordConfirmation:password},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result?(API.out({datas:{name:"toast",text:i18n("重置密码成功，请重新登录")}}),setTimeout(function(){API.out({command:"rootBack"})},1e3)):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({command:"stopLoading"}),API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else if(json.fetchverifycode4reset){var emailOrPhone=json.phone,type="resetpwd",attempt=json.attempt;xhr({url:host+"/api/v2/users/fetchverifycode",async:!0,data:{emailOrPhone:emailOrPhone,type:type,attempt:attempt},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result?(API.out({datas:{name:"captcha",text:data.content.response}}),clearInterval(counddowninterval),countdown=countdownsecond,API.out({datas:{name:"countdown",title:countdown+"s后重新发送",enable:!1}}),counddowninterval=setInterval(countDown,1e3),API.out({datas:{name:"captcha",text:data.content.response}})):data.errors&&(API.out({datas:{name:"countdown",enable:!0}}),API.out({datas:{name:"toast",text:data.errors[0]}}))},error:function(t){API.out({command:"stopLoading"})}})}else if(json.updatepassword){var oldPassword=json.oldPassword,newPassword=json.newPassword;xhr({url:host+"/api/v2/user/profile/password/change",async:!0,data:{oldPassword:oldPassword,newPassword:newPassword},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),API.out({command:"stopLoading"}),"success"===data.result?(API.out({datas:{name:"toast",text:i18n("修改成功")}}),setTimeout(function(){API.out({command:"rootBack"})},1e3)):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({command:"stopLoading"})}})}else if(json.authorizationCaptcha){var name=json.username;xhr({url:host+"/api/v2/borrower/creditcenter/captcha",async:!0,data:{username:name},method:"POST",success:function(data){"string"==typeof data&&(data=eval("("+data+")")),"success"===data.result?data.content.captchaUrl&&API.out({datas:{name:"captchaImg",image:data.content.captchaUrl}}):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){t.errors&&API.out({datas:{name:"toast",text:t.errors[0]}})}})}else if(json.authorization){var loanId=json.loanId,name=json.username,password=json.password,verifyCode=json.verifyCode,captcha=json.captcha,authtype=json.authType;xhr({url:host+"/api/v2/borrower/creditcenter/authorization",async:!0,data:{loanId:loanId,username:name,password:password,authenticationCode:verifyCode,captcha:captcha,authType:authtype},method:"POST",success:function(data){API.out({command:"stopLoading"}),"string"==typeof data&&(data=eval("("+data+")")),"success"===data.result?data.content.authorized?(API.out({datas:{name:"toast",text:"认证成功",icon:"ok"}}),setTimeout(function(){API.out({command:"back"})},2e3)):(data.content.errorMessage&&API.out({datas:{name:"toast",text:data.content.errorMessage}}),data.content.captchaUrl&&API.out({datas:{name:"captchaImg",image:data.content.captchaUrl}})):data.errors&&API.out({datas:{name:"toast",text:data.errors[0]}})},error:function(t){API.out({command:"stopLoading"}),API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}}}}();var api_in=API["in"];API["in"]=function(t){borrower.on(t),api_in(t)};