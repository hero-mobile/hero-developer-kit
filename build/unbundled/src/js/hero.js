var xhr=function(){var t=function(){return"XMLHttpRequest"in window?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")}}(),e=function(t){var e="";for(var o in t)t[o]&&(e+=o+"="+t[o]+"&");return e.slice(0,-1)},o=function(o){var n=this,a=t();n.url=o.url,n.contentType=o.contentType,n.type=o.type||"responseText",n.method=o.method||"GET",n.async=o.async||!0,n.data=o.data||{},n.complete=o.complete||function(){},n.success=o.success||function(){},n.error=o.error||function(t){alert(n.url+"->status:"+t+"error!")},n.abort=a.abort,n.setData=function(t){for(var e in t)n.data[e]=t[e]},n.send=function(){var t,o=e(n.data),r=!1,c=n.async,i=n.complete,s=n.method,u=n.type;"GET"===s&&(n.url+="?"+o,r=!0),a.timeout=3e4,a.open(s,n.url,c),r||(n.contentType?a.setRequestHeader("Content-type",n.contentType):a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t=o),a.onreadystatechange=c?function(){4==a.readyState&&(i(),200==a.status?n.success(a[u]):n.error(a.status))}:null,a.send(t),c||(i(),n.success(a[u]))},n.url&&n.send()};return function(t){return new o(t)}}(),host=window.location.origin,path=host+"/borrower-static/wallet/v6.2";localStorage.versionPath=path;var ui,err_ui={nav:{title:"界面出错啦"},views:[{"class":"HeroButton",frame:{x:"0.3x",y:"44",w:"0.4x",h:"66"},title:"刷新",click:{command:"refresh"}}]},ui2Data={};!function(){var t,e,o,n=window,a="PC";document.onreadystatechange=function(){var t=document.readyState;if("complete"==t){if(o=API.getInitData(),o.test){var e=document.createElement("script");if(e.src=host+window.location.pathname.replace(/html/,"js"),document.head.appendChild(e),host.search(/10./)>0){var e=document.createElement("script");e.src=path+"/js/log.js",document.head.appendChild(e)}}var n=navigator.userAgent.toLowerCase();n.indexOf("hero-ios")>0?API.setDeviceType("IOS"):n.indexOf("hero-android")>0?API.setDeviceType("ANDROID"):n.indexOf("micromessenger")>0?API.setDeviceType("WECHAT"):(API.setDeviceType("PC"),console.log("%cyou are hero !!! ","background-image:-webkit-gradient( linear, left top, right top, color-stop(0, #f22), color-stop(0.15, #f2f), color-stop(0.3, #22f), color-stop(0.45, #2ff), color-stop(0.6, #2f2),color-stop(0.75, #2f2), color-stop(0.9, #ff2), color-stop(1, #f22) );color:transparent;-webkit-background-clip: text;font-size:5em;")),ui&&ui.views&&API.ui2Data(ui.views),ui&&ui.views&&API.ui2Data(ui.views)}},n.API={c0:"00bc8d",c1:"cccccc",c2:"999999",c3:"666666",c4:"333333",c5:"1e304a",c6:"d70c18",c7:"ffffff",c8:"fbfbfb",c9:"f5f5f5",c10:"f0f0f0",c11:"e4e4e4",c12:"ff5500",c13:"ff7842",c14:"33b653",c15:"ffeeee",c16:"ffb7b7",c17:"f2fffd",c18:"daf8f3",c19:"37455c",c20:"f9fdfd",c21:"f4fbfb",c02:"009671",c62:"ac0913",c71:"ffffffb2",c75:"ffffff80",s0:"56",s6:"45",s9:"33",s1:"28",s7:"20",s2:"18",s3:"16",s4:"14",s5:"12",s8:"11",connect:function(t){io=io.connect(),io.on("connect",function(){io.emit("sub",t)}),io.on("message",function(t){API.out(t)})},disconnect:function(){io.disconnect()},out:function(t){if("IOS"==a){"object"==typeof t&&(t=JSON.stringify(t)),t=encodeURIComponent(t);var e="hero://"+t,o=document.createElement("iframe");o.setAttribute("src",e),document.documentElement.appendChild(o),o.parentNode.removeChild(o),o=null}else"IOS8"==a?window.webkit.messageHandlers["native"].postMessage(t):"ANDROID"==a?("object"==typeof t&&(t=JSON.stringify(t)),window["native"].on(t)):API.page.on(t)},"in":function(o){if("string"==typeof o&&(o=JSON.parse(o)),o.serverLog&&xhr({url:"/log",async:!0,data:{path:window.location.href,log:o},error:function(){}}),o.her)"/"==e.charAt(0)?(o=o.her,xhr({url:e,data:o,async:!0,method:"GET",success:function(t){API.out(t)},error:function(t){API.out(t)}})):(o=o.her,o.userid=t,o.card=e,io.emit("on",o));else if(o.socket)io.emit("message",o.socket);else if(o.http){API.out({datas:{name:"toast",text:""}}),o=o.http;var n=o.url,a=o.success,r=o.fail;xhr({url:n.search(/ttp/)>0?n:host+n,async:!0,data:o.data,contentType:o.contentType,method:o.method?o.method:"GET",success:function(t){if(API.out({command:"stopLoading"}),"string"==typeof t&&(t=JSON.parse(t)),"success"===t.result)a?a(t):(t.api=n,API.reloadData(t));else if("login"===t.result){localStorage.username="";var e="https://auth.dianrong.com";host.search(/localhost|10/)>0&&(e=host),host.search(/dev/)>0?e="https://auth-dev.dianrong.com":host.search(/demo/)>0?e="https://auth-demo.dianrong.com":host.search(/stage/)>0&&(e="https://auth.stage.dianrong.com"),API.out({command:"present:"+e+"/auth-server/borrower-static/wallet/v3/login.html"})}else"error"===t.result?t.errors&&t.errors.length>0?r?r(t):API.out({datas:{name:"toast",text:t.errors[0]}}):t.content&&t.content.apiReturn&&(t.content.apiReturn.ValidationError||t.content.apiReturn.ErrorMessage)&&(r?r(t):t.content.apiReturn.ValidationError?API.out({datas:{name:"toast",text:t.content.apiReturn.ValidationError}}):API.out({datas:{name:"toast",text:t.content.apiReturn.ErrorMessage}})):API.reloadData(t)},error:function(t){API.out({command:"stopLoading"}),r?r(t):API.out({datas:{name:"toast",icon:"error_icon",text:"网络异常，请检查网络连接后重试"}})}})}else o.name&&o.value&&(ui2Data["_"+o.name]=o.value),API.special_logic(o)},special_logic:function(){},boot:function(){},reloadData:function(){},deviceType:function(){return a},setDeviceType:function(t){a=t,void 0===ui&&(ui=err_ui),"blank"!==ui&&API.out({ui:ui}),"IOS"===a?API.boot(o):"ANDROID"===a?API.boot(o):setTimeout(function(){API.boot(o)},500)},setUserid:function(e){t=e},setCard:function(t){e=t,"/"!==e.charAt(0)&&API.connect()},getInitData:function(){localStorage.boot&&(o=JSON.parse(localStorage.boot),localStorage.boot=""),o=o||{};var t=(window.location.search.split("?")[1]||"").split("&");for(var e in t)t.hasOwnProperty(e)&&(paramParts=t[e].split("="),o[paramParts[0]]=decodeURIComponent(paramParts[1]||""));return o},ui2Data:function(t){if(t instanceof Array)for(var e=0;e<t.length;e++)API.ui2Data(t[e]);else t.subViews&&API.ui2Data(t.subViews);t.name&&(ui2Data["_"+t.name]={},ui2Data.__defineSetter__(t.name,function(e){ui2Data["_"+t.name]=e;var o={name:t.name};"string"==typeof e?o.text=e:API.merge(o,e),API.out({datas:o})}),ui2Data.__defineGetter__(t.name,function(){return ui2Data["_"+t.name]}))},getDeviceType:function(){return a},getVersion:function(){return"0.0.1"},getCookie:function(t){var e,o=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(o))?unescape(e[2]):null},camelCase2bar:function(t){for(var e=t.toLowerCase(),o=e.substr(0,2),n=2;n<t.length;n++)o=t.charAt(n)!==e.charAt(n)?o.concat("-"+e.charAt(n)):o.concat(e.charAt(n));return o},createElementFromJson:function(t){var e=t["class"]||t.res;if(e){var o=API.camelCase2bar(e),n="<"+o+" json="+encodeURIComponent(JSON.stringify(t))+"></"+o+">";return n}return""},merge:function(t,e){for(var o in e)t[o]=e[o];return t}}}();